# SUBQUERIES

- Subqueries (subquery atau nested query) adalah query yang terdapat di dalam query utama. Nantinya Query utama menggunakan hasil dari subquery sebagai salah satu kriteria atau elemen dalam query itu sendiri.
- Subquery dapat digunakan di berbagai bagian pernyataan SQL, seperti dalam bagian `SELECT`, `FROM`, `WHERE`, atau `HAVING`.
- Subquery biasanya digunakan untuk mengambil data yang akan digunakan dalam pernyataan utama atau untuk membuat pernyataan yang lebih kompleks.

# 1. SUBQUERIES - WHERE

- `WHERE` merupakan salah satu bagian yang paling sering digunakan sebagai tempat pembuatan subqueries. Hal tersebut disebabkan karena filter data menjadi hal yang sangat umum dalam manipulasi data
- subquery dalam `WHERE` membantu menyaring baris-baris data berdasarkan kondisi yang melibatkan data dari tabel atau subquery lain.
- umumnya `WHERE` akan menggunakan operator `IN` saat menggunakan subqueries. 

Misalkan kita memiliki dua tabel, "Customers" dan "Orders," seperti yang dijelaskan sebelumnya. Sekarang, kita ingin menemukan pelanggan yang memiliki pesanan dengan jumlah lebih dari 50.00:

```SQL
SELECT Name
FROM Customers
WHERE ID IN
  (SELECT CustomerID
   FROM Orders
   WHERE Amount > 50.000);
```

Pada contoh di atas, subquery yang terletak di dalam klausa WHERE adalah *(SELECT CustomerID FROM Orders WHERE Amount > 50.00)*. Subquery ini menghasilkan daftar CustomerID dari pesanan yang memiliki jumlah lebih dari 50.000.

- Penting untuk dicatat beberapa poin:
  - Subquery `WHERE` menghasilkan daftar nilai yang digunakan dalam perbandingan dengan klausa `WHERE` utama (ID IN (...)).
  - Subquery `WHERE` dapat mengandung berbagai jenis pernyataan `SELECT`, seperti fungsi agregasi, operasi JOIN, atau pernyataan SELECT sederhana lainnya.
  - Pastikan subquery menghasilkan satu kolom atau nilai tunggal untuk perbandingan.


 # 2. SUBQUERIES - SELECT

 - digunakan untuk menggabungkan hasil dari satu query dengan hasil dari query lainnya, dan kemudian hasil gabungan ini digunakan dalam pernyataan `SELECT` utama
 - Subquery dalam `SELECT` biasanya digunakan untuk menghitung atau memperoleh nilai yang akan dimasukkan ke dalam hasil akhir.

Misalkan kita ingin menampilkan nama pelanggan dan total jumlah pesanan yang dilakukan oleh setiap pelanggan:

```SQL
SELECT Name,
  (SELECT COUNT(*)
   FROM Orders
   WHERE CustomerID = Customers.ID) AS TotalOrders
FROM Customers;
```
Pada contoh di atas, subquery dalam `SELECT` adalah **(SELECT COUNT(*) FROM Orders WHERE CustomerID = Customers.ID)**. Subquery ini menghitung jumlah pesanan untuk setiap pelanggan di tabel "Customers." 
Hasilnya digunakan sebagai kolom baru bernama "TotalOrders" dalam hasil akhir.

Penting untuk dicatat beberapa poin:
  - Subquery `SELECT` dapat mengembalikan satu nilai, satu kolom, atau satu baris data.
  - Subquery `SELECT` dapat menggunakan fungsi agregasi seperti COUNT, SUM, AVG, dll., atau dapat mengandung pernyataan `SELECT` sederhana.
  - Subquery `SELECT` dapat ditempatkan di dalam klausa `SELECT` untuk menghasilkan nilai tambahan yang akan dimasukkan ke dalam setiap baris hasil query utama.


# 3. SUBQUERIES - FROM

- Subquery dalam klausa FROM digunakan untuk membuat tabel sementara (temporary table) yang kemudian digunakan dalam query utama.
- Subquery FROM membantu Anda menghasilkan data yang akan diolah lebih lanjut dalam query utama.

Misalkan kita ingin menampilkan nama pelanggan bersama dengan jumlah pesanan yang dilakukan oleh setiap pelanggan, tetapi hanya untuk pelanggan yang memiliki lebih dari satu pesanan:

```SQL
SELECT Customers.Name, SubqueryTable.OrderCount
FROM Customers
JOIN (SELECT CustomerID, COUNT(*) AS OrderCount FROM Orders GROUP BY CustomerID) AS SubqueryTable
ON Customers.ID = SubqueryTable.CustomerID
WHERE SubqueryTable.OrderCount > 1;
```

